# .github/workflows/firebase-deploy.yml
name: Deploy to Firebase on Merge

# Define when this workflow should run:
on:
  push:
    branches:
      - main # Only run when code is merged (pushed) to the main branch

jobs:
  build_and_deploy:
    name: Build and Deploy to Firebase
    runs-on: ubuntu-latest # Use the latest Ubuntu environment for the job

    steps:
      # 1. Checkout the source code from the repository
      - name: Checkout Repo
        uses: actions/checkout@v4

      # 2. Set up Node.js (Crucial for building and running Firebase CLI)
      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: "20" # Use a stable Node version (adjust if your project requires a different one)

      # 3. Install project dependencies
      - name: Install Dependencies
        run: npm install # Or 'yarn install' if you use Yarn

      # 4. Build the application (e.g., React, Vue, Angular build)
      # This step generates the static files to be deployed to Firebase Hosting
      - name: Build Project
        run: npm run build # Update this command if your build script is different (e.g., 'yarn build')

      # 5. Deploy to Firebase
      # Uses the official Firebase Action for streamlined deployment
      - name: Deploy to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}" # Used by GitHub to manage deployment status
          firebaseServiceAccount: "${{ secrets.FIREBASE_DEPLOY_TOKEN }}" # The secret token we created
          channelId: live # Deploy to the default 'live' channel (production)
          projectId: YOUR_FIREBASE_PROJECT_ID # <-- **CRITICAL: Replace this with your actual Firebase Project ID**


      # NOTES on Firestore/Functions Deployment:
      # The hosting-deploy action automatically finds and deploys Firebase Functions and Database rules
      # if they are defined in your firebase.json file and your build process handles them.
      # If you only use Firestore/Functions without hosting, you might use the Firebase CLI
      # directly in a 'run' step instead of this action, e.g.:
      # run: firebase deploy --token ${{ secrets.FIREBASE_DEPLOY_TOKEN }}
